server:
  port: 18080
  shutdown: graceful
  netty:
    connection-timeout: 5s
  error:
    include-message: always
    include-binding-errors: always
    include-stacktrace: on-param
    include-exception: true

proxy:
  enabled: true
  host: 127.0.0.1        # å®¹å™¨å†…æ”¹ä¸º host.docker.internal æˆ–ä»£ç†å®¹å™¨å
  port: 6888             # è‹¥æ˜¯ socks ç›‘å¬ç«¯å£ä¸åŒï¼Œè¯·æ”¹ä¸ºå®é™…ç«¯å£
  type: socks            # å…³é”®ï¼šåˆ‡æ¢ä¸º socks
  applySystemProperties: true
  applyProxySelector: false
  trustAllCerts: true   # æ’éšœæ—¶å¯ä¸´æ—¶ trueï¼Œç”Ÿäº§è¯· false

spring:
  application:
    name: ai-novel-server
  data:
    mongodb:
      uri: mongodb://admin:admin123@localhost:27017/ainovel?replicaSet=rs0&authSource=admin&retryWrites=true&retryReads=true
      auto-index-creation: true
      database: ainovel
      authentication-database: admin
  aop:
    auto: false
  webflux:
    base-path: /
  lifecycle:
    timeout-per-shutdown-phase: 30s

logging:
  level:
    root: INFO
    com.ainovel: INFO
    com.ainovel.server: INFO
    # æ·»åŠ MongoDBæŸ¥è¯¢æ—¥å¿—é…ç½®
    org.springframework.data.mongodb: WARN
    com.ainovel.server.service.impl.ImportServiceImpl: DEBUG
    com.ainovel.server.config.MongoQueryCounterAspect: WARN
    org.springframework.data.mongodb.core.ReactiveMongoTemplate: WARN
    org.springframework.data.mongodb.core.MongoTemplate: WARN
    org.springframework.data.mongodb.repository.query: WARN
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.eclipse.angus.mail.smtp: DEBUG
    reactor.netty: WARN
    # MongoDB æ˜ å°„è°ƒè¯•æ—¥å¿— - ç”¨äºæ’æŸ¥ MappingException
    org.springframework.data.mongodb.core.convert: WARN
    org.springframework.data.mongodb.core.mapping: WARN
    org.springframework.data.mapping: WARN
    org.springframework.data.mapping.model: WARN
    # MongoDB Java Driver è°ƒè¯•ï¼ˆå¯é€‰ï¼‰
    org.mongodb.driver: WARN
    # MongoDB Event Listener - å…³é—­è¯¦ç»†çš„æ–‡æ¡£å†…å®¹æ—¥å¿—
    org.springframework.data.mongodb.core.mapping.event.LoggingEventListener: WARN
    # é™å™ªï¼šä¸‹åˆ—ç»„ä»¶åœ¨å¼€å‘ä¸­äº§ç”Ÿå¤§é‡é‡å¤æ—¥å¿—ï¼Œé»˜è®¤ä»…ä¿ç•™ WARN+
    com.ainovel.server.security.JwtAuthenticationManager: WARN
    com.ainovel.server.web.controller.TaskStatusController: WARN
    com.ainovel.server.web.controller.NovelSnippetController: WARN
    com.ainovel.server.web.controller.AIChatController: WARN
    com.ainovel.server.web.controller.UserAIModelConfigController: WARN  # é¿å…åœ¨Controllerå±‚æ‰“å°æ˜æ–‡apiKey
    com.ainovel.server.service.impl.NovelSettingServiceImpl: WARN
    com.ainovel.server.service.impl.NovelServiceImpl: WARN
    com.ainovel.server.service.impl.AIServiceImpl: WARN
    com.ainovel.server.config.LoggingConfiguration: INFO
    com.ainovel.server.controller.ProviderCapabilityController: WARN
    com.ainovel.server.controller.UnifiedPresetAggregationController: WARN
    com.ainovel.server.web.controller.NovelController: WARN
    com.ainovel.server.web.controller.NovelSettingHistoryController: WARN
    com.ainovel.server.service.impl.NovelSettingHistoryServiceImpl: WARN
    com.ainovel.server.service.impl.UnifiedPresetAggregationServiceImpl: WARN
    com.ainovel.server.service.impl.UserAIModelConfigServiceImpl: WARN
    com.ainovel.server.service.impl.ApiKeyValidatorImpl: INFO
    com.ainovel.server.service.ai: WARN
    com.ainovel.server.service.ai.langchain4j: INFO
    com.ainovel.server.service.ai.langchain4j.QwenLangChain4jModelProvider: INFO
    com.ainovel.server.service.ai.langchain4j.LangChain4jModelProvider: WARN
    com.ainovel.server.service.ai.langchain4j.ZhipuLangChain4jModelProvider: WARN
    com.ainovel.server.service.ai.langchain4j.DoubaoLangChain4jModelProvider: WARN
    com.ainovel.server.service.ai.langchain4j.SiliconFlowLangChain4jModelProvider: WARN
    com.ainovel.server.service.ai.langchain4j.TogetherAILangChain4jModelProvider: WARN

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,jmx
    jmx:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
    jmx:
      enabled: true
  jmx:
    enabled: true
  # æ›´æ–°è¿‡æ—¶çš„é…ç½®
  prometheus:
    metrics:
      export:
        enabled: true
  tracing:
    enabled: true
    sampling:
      probability: 1.0
    exporter:
      otlp:
        enabled: true
        endpoint: http://${OTLP_TRACES_HOST:localhost}:${OTLP_TRACES_PORT:11800}
  metrics:
    tags:
      application: ${spring.application.name}
      environment: dev
    distribution:
      percentiles-histogram:
        "[tasks.execution.time]": true
        "[http.server.requests]": true
      percentiles:
        "[tasks.execution.time]": [0.5, 0.95, 0.99]
        "[http.server.requests]": [0.5, 0.95, 0.99]
      slo:
        "[tasks.execution.time]": [2000ms, 10000ms, 30000ms]

        "[http.server.requests]": [100ms, 300ms, 1s, 3s, 5s]

# è‡ªå®šä¹‰é…ç½®
ainovel:
  security:
    jwt:
      # ä¸ºäº†å…¼å®¹æ—§ä»£ç è¯»å–æ­¤é”®çš„åœºæ™¯ï¼Œè¿™é‡Œä¹Ÿç»Ÿä¸€å¼•ç”¨åŒä¸€ä¸ªç¯å¢ƒå˜é‡
      secret-key: ${JWT_SECRET:aiNovelSecretKey12345678901234567890}
      expiration-time: 86400000  # 24å°æ—¶ï¼Œå•ä½æ¯«ç§’
      refresh-token-expiration: 604800000  # 7å¤©ï¼Œå•ä½æ¯«ç§’
  performance:
    virtual-threads:
      enabled: true
    monitoring:
      enabled: true
    testing:
      security-disabled: true  # ç¦ç”¨å®‰å…¨éªŒè¯ï¼Œæ–¹ä¾¿æµ‹è¯•
  # æ·»åŠ MongoDBæŸ¥è¯¢æ—¥å¿—é…ç½®
  mongodb:
    logging:
      enabled: true
      query-level: DEBUG
      result-count: true
  # ğŸš€ é«˜çº§å¹¶å‘æ§åˆ¶é…ç½®
  concurrency:
    # åˆ†å¸ƒå¼é”é…ç½®
    distributed-lock:
      enabled: false  # å¼€å‘ç¯å¢ƒé»˜è®¤å…³é—­ï¼Œç”Ÿäº§ç¯å¢ƒå¯å¼€å¯
      redis:
        host: localhost
        port: 6379
        timeout: 5000  # é”è¶…æ—¶æ—¶é—´(ms)
    # å¼‚æ­¥é˜Ÿåˆ—é…ç½®  
    async-queue:
      enabled: false  # å¼€å‘ç¯å¢ƒé»˜è®¤å…³é—­ï¼Œé«˜å¹¶å‘æ—¶å¯å¼€å¯
      capacity: 1000
      worker-threads: 5
    # ä¹è§‚é”é…ç½®
    optimistic-lock:
      enabled: true   # æ¨èå¯ç”¨ï¼Œæ€§èƒ½æœ€ä½³
      max-retries: 5
      base-delay: 10  # åŸºç¡€é‡è¯•å»¶è¿Ÿ(ms)
# ç¦ç”¨JWTéªŒè¯ï¼Œæ–¹ä¾¿æµ‹è¯•
security:
  jwt:
    disabled: false

# ç»Ÿä¸€ JwtServiceImpl çš„è¯»å–æ¥æºï¼ˆdev ç¯å¢ƒï¼‰
jwt:
  secret: ${JWT_SECRET:aiNovelSecretKey12345678901234567890}
  expiration: 86400000
  refresh-expiration: 604800000

# æ˜¾å¼å›ºå®šå¼€å‘ç¯å¢ƒçš„ Jasypt åŠ è§£å¯†é…ç½®ï¼Œé¿å…è¢«å¤–éƒ¨ç¯å¢ƒå˜é‡å¹²æ‰°
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD:${JASYPT_PASSWORD:AINoval_Secure_Encryption_Key_2025}}
    algorithm: PBEWITHHMACSHA512ANDAES_256
    iv-generator-classname: org.jasypt.iv.RandomIvGenerator

# ç•ªèŒ„å°è¯´æœåŠ¡é…ç½®
fanqie:
  api:
    base-url: http://localhost:5000     # åç«¯æœåŠ¡è°ƒç”¨ï¼ˆå†…ç½‘ç›´è¿ï¼‰
    public-url: http://localhost:5000   # å‰ç«¯è®¿é—®çš„å…¬å¼€URLï¼ˆå¼€å‘ç¯å¢ƒä¹Ÿæ˜¯ç›´è¿ï¼‰
    timeout: 30
