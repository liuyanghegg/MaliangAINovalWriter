server:
  port: 18080
  shutdown: graceful
  netty:
    connection-timeout: 5s
  error:
    include-message: always
    include-binding-errors: always
    include-stacktrace: on-param
    include-exception: true

proxy:
  enabled: true
  host: 127.0.0.1        # å®¹å™¨å†…æ”¹ä¸º host.docker.internal æˆ–ä»£ç†å®¹å™¨å
  port: 6888             # è‹¥æ˜¯ socks ç›‘å¬ç«¯å£ä¸åŒï¼Œè¯·æ”¹ä¸ºå®é™…ç«¯å£
  type: socks            # å…³é”®ï¼šåˆ‡æ¢ä¸º socks
  applySystemProperties: true
  applyProxySelector: false
  trustAllCerts: true   # æ’éšœæ—¶å¯ä¸´æ—¶ trueï¼Œç”Ÿäº§è¯· false

spring:
  application:
    name: ai-novel-server
  data:
    mongodb:
      uri: mongodb://localhost:27017/ainoval_performance_test?
      auto-index-creation: true
      database: ainovel
      authentication-database: admin
  webflux:
    base-path: /
  lifecycle:
    timeout-per-shutdown-phase: 30s

logging:
  level:
    root: INFO
    com.ainovel: INFO
    com.ainovel.server: INFO
    # æ·»åŠ MongoDBæŸ¥è¯¢æ—¥å¿—é…ç½®
    org.springframework.data.mongodb: WARN
    com.ainovel.server.service.impl.ImportServiceImpl: DEBUG
    com.ainovel.server.config.MongoQueryCounterAspect: WARN
    org.springframework.data.mongodb.core.ReactiveMongoTemplate: WARN
    org.springframework.data.mongodb.core.MongoTemplate: WARN
    org.springframework.data.mongodb.repository.query: WARN
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.eclipse.angus.mail.smtp: DEBUG
    reactor.netty: WARN
    # MongoDB æ˜ å°„è°ƒè¯•æ—¥å¿— - ç”¨äºæ’æŸ¥ MappingException
    org.springframework.data.mongodb.core.convert: WARN
    org.springframework.data.mongodb.core.mapping: WARN
    org.springframework.data.mapping: WARN
    org.springframework.data.mapping.model: WARN
    # MongoDB Java Driver è°ƒè¯•ï¼ˆå¯é€‰ï¼‰
    org.mongodb.driver: WARN
    # MongoDB Event Listener - å…³é—­è¯¦ç»†çš„æ–‡æ¡£å†…å®¹æ—¥å¿—
    org.springframework.data.mongodb.core.mapping.event.LoggingEventListener: WARN
    # é™å™ªï¼šä¸‹åˆ—ç»„ä»¶åœ¨å¼€å‘ä¸­äº§ç”Ÿå¤§é‡é‡å¤æ—¥å¿—ï¼Œé»˜è®¤ä»…ä¿ç•™ WARN+
    # com.ainovel.server.security.JwtAuthenticationManager: WARN
    # com.ainovel.server.web.controller.TaskStatusController: WARN
    # com.ainovel.server.web.controller.NovelSnippetController: WARN
    # com.ainovel.server.web.controller.AIChatController: WARN
    # com.ainovel.server.web.controller.UserAIModelConfigController: WARN  # é¿å…åœ¨Controllerå±‚æ‰“å°æ˜æ–‡apiKey
    # com.ainovel.server.service.impl.NovelSettingServiceImpl: WARN
    # com.ainovel.server.service.impl.NovelServiceImpl: WARN
    # com.ainovel.server.service.impl.AIServiceImpl: WARN
    # com.ainovel.server.config.LoggingConfiguration: INFO
    # com.ainovel.server.controller.ProviderCapabilityController: WARN
    # com.ainovel.server.controller.UnifiedPresetAggregationController: WARN
    # com.ainovel.server.web.controller.NovelController: WARN
    # com.ainovel.server.web.controller.NovelSettingHistoryController: WARN
    # com.ainovel.server.service.impl.NovelSettingHistoryServiceImpl: WARN
    # com.ainovel.server.service.impl.UnifiedPresetAggregationServiceImpl: WARN
    # com.ainovel.server.service.impl.UserAIModelConfigServiceImpl: WARN
    # com.ainovel.server.service.impl.ApiKeyValidatorImpl: INFO
    # com.ainovel.server.service.ai: WARN
    # com.ainovel.server.service.ai.langchain4j: INFO
    # com.ainovel.server.service.ai.langchain4j.QwenLangChain4jModelProvider: INFO
    # com.ainovel.server.service.ai.langchain4j.LangChain4jModelProvider: WARN
    # com.ainovel.server.service.ai.langchain4j.ZhipuLangChain4jModelProvider: WARN
    # com.ainovel.server.service.ai.langchain4j.DoubaoLangChain4jModelProvider: WARN
    # com.ainovel.server.service.ai.langchain4j.SiliconFlowLangChain4jModelProvider: WARN
    # com.ainovel.server.service.ai.langchain4j.TogetherAILangChain4jModelProvider: WARN

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,jmx
    jmx:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
    jmx:
      enabled: true
  jmx:
    enabled: true
  # æ›´æ–°è¿‡æ—¶çš„é…ç½®
  prometheus:
    metrics:
      export:
        enabled: true
  tracing:
    enabled: true
    sampling:
      probability: 1.0
    exporter:
      otlp:
        enabled: true
        endpoint: http://${OTLP_TRACES_HOST:localhost}:${OTLP_TRACES_PORT:11800}
  metrics:
    tags:
      application: ${spring.application.name}
      environment: dev
    distribution:
      percentiles-histogram:
        "[tasks.execution.time]": true
        "[http.server.requests]": true
      percentiles:
        "[tasks.execution.time]": [0.5, 0.95, 0.99]
        "[http.server.requests]": [0.5, 0.95, 0.99]
      slo:
        "[tasks.execution.time]": [2000ms, 10000ms, 30000ms]

        "[http.server.requests]": [100ms, 300ms, 1s, 3s, 5s]

# è‡ªå®šä¹‰é…ç½®
ainovel:
  security:
    jwt:
      # ä¸ºäº†å…¼å®¹æ—§ä»£ç è¯»å–æ­¤é”®çš„åœºæ™¯ï¼Œè¿™é‡Œä¹Ÿç»Ÿä¸€å¼•ç”¨åŒä¸€ä¸ªç¯å¢ƒå˜é‡
      secret-key: ${JWT_SECRET:aiNovelSecretKey12345678901234567890}
      expiration-time: 86400000  # 24å°æ—¶ï¼Œå•ä½æ¯«ç§’
      refresh-token-expiration: 604800000  # 7å¤©ï¼Œå•ä½æ¯«ç§’
  performance:
    virtual-threads:
      enabled: true
    monitoring:
      enabled: true
    testing:
      security-disabled: true  # ç¦ç”¨å®‰å…¨éªŒè¯ï¼Œæ–¹ä¾¿æµ‹è¯•
  # æ·»åŠ MongoDBæŸ¥è¯¢æ—¥å¿—é…ç½®
  mongodb:
    logging:
      enabled: true
      query-level: DEBUG
      result-count: true
  # ğŸš€ é«˜çº§å¹¶å‘æ§åˆ¶é…ç½®
  concurrency:
    # åˆ†å¸ƒå¼é”é…ç½®
    distributed-lock:
      enabled: false  # å¼€å‘ç¯å¢ƒé»˜è®¤å…³é—­ï¼Œç”Ÿäº§ç¯å¢ƒå¯å¼€å¯
      redis:
        host: localhost
        port: 6379
        timeout: 5000  # é”è¶…æ—¶æ—¶é—´(ms)
    # å¼‚æ­¥é˜Ÿåˆ—é…ç½®  
    async-queue:
      enabled: false  # å¼€å‘ç¯å¢ƒé»˜è®¤å…³é—­ï¼Œé«˜å¹¶å‘æ—¶å¯å¼€å¯
      capacity: 1000
      worker-threads: 5
    # ä¹è§‚é”é…ç½®
    optimistic-lock:
      enabled: true   # æ¨èå¯ç”¨ï¼Œæ€§èƒ½æœ€ä½³
      max-retries: 5
      base-delay: 10  # åŸºç¡€é‡è¯•å»¶è¿Ÿ(ms)

# ç¦ç”¨JWTéªŒè¯ï¼Œæ–¹ä¾¿æµ‹è¯•
security:
  jwt:
    disabled: false

# ç»Ÿä¸€ JwtServiceImpl çš„è¯»å–æ¥æºï¼ˆdev ç¯å¢ƒï¼‰
jwt:
  secret: ${JWT_SECRET:aiNovelSecretKey12345678901234567890}
  expiration: 86400000
  refresh-expiration: 604800000

# æ˜¾å¼å›ºå®šå¼€å‘ç¯å¢ƒçš„ Jasypt åŠ è§£å¯†é…ç½®ï¼Œé¿å…è¢«å¤–éƒ¨ç¯å¢ƒå˜é‡å¹²æ‰°
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD:${JASYPT_PASSWORD:AINoval_Secure_Encryption_Key_2025}}
    algorithm: PBEWITHHMACSHA512ANDAES_256
    iv-generator-classname: org.jasypt.iv.RandomIvGenerator

# ç•ªèŒ„å°è¯´æœåŠ¡é…ç½®
fanqie:
  api:
    base-url: http://localhost:5000     # åç«¯æœåŠ¡è°ƒç”¨ï¼ˆå†…ç½‘ç›´è¿ï¼‰
    public-url: http://localhost:5000   # å‰ç«¯è®¿é—®çš„å…¬å¼€URLï¼ˆå¼€å‘ç¯å¢ƒä¹Ÿæ˜¯ç›´è¿ï¼‰
    timeout: 30

# æ”¯ä»˜é…ç½®ï¼ˆæ²™ç®±ç¯å¢ƒï¼‰
payment:
  alipay:
    app-id: 9021000141614237  # æ²™ç®±ç¯å¢ƒAppId
    sandbox: true  # å¯ç”¨æ²™ç®±æ¨¡å¼
    # å•†æˆ·ç§é’¥ï¼ˆä»æä¾›çš„æ–‡ä»¶ä¸­è¯»å–ï¼‰
    merchant-private-key-pem: MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDVCR3F0Iodx/YNev9nuYHkv5qf81j6+9zz+dC3wK1BbRnCoxer1tjFvQ1msl26erI2+VPGQxY5+Z+X+3gZ7K2K1brIElYb93Gesb0r2DIFKmUBnYb4o8VoKXK6STUMnJftOugvN1gYpFIlI4BlkuUzmO6jHyPatYLDlkpvp8Aw1WPdr9e/kOZLk3auGpWGPmyAO64Sdhvb7HqhNKe9s7rgc/yBLcfvDmWs2AFHtjSMgYTSnHyV5nArVADimsyS2GMqaXTRk/8KUpSX0rHYIPFl1Z2fAjC2ZgiRVzj5pnbNn1ZZz8JfTxtTT4nCRihO28K60BlFBYZCHGRzfZDIWgLLAgMBAAECggEAYj8iC+hwyes9/lmLEDrtPKFgngOMNbOR4rKDHzssq8+04Z51fDpJHmhhlcsMjsOnDNNPX0/xICuO/nhqmwobvrtyuHI8ZAlpzNYLd/zslJVIn8YWSPS+RZtX3bGFVZuiNTXFfoD3j+W4PIhy3mUwbutIotHppyOueqUFDxk9+UaXyf0PVfFLI9gRxgW9PBHE70qvMv9+HcZJVtEIKXXpEhsNTr6n+1a4v+AGTawNMijyHjdF72O8PzQ9e3Ibda5DqXLzDYPhTCpn6N8eu9Cyc5xoJtNWNxiYFdIYUhBltPfVi3G28l0LEB5+pFlxPmYWzuV7CR21+y/SP7PsemnzgQKBgQD/6lotM1iJktNaqCqf4HxOpk6BU+JaAd+O8vxdWUGaSKJ2lhRIx6VNwrG8m2nHgxZvKDnV4waDrbp72/81VaNFHn+n3yEq3DGrFOrBbgOMpBA8r1LNSYpbWi7LM0WdrfXxkYAxTm6DibvpK9+QM/4L6uAwvsGBIgbbgHtH13ooBQKBgQDVGyMJqInv2r03R3dRYVQQj6n4C9Xh26OyG8TVwUtYxDwMRcwxR6z0fNhKhRzmwAyXByNT1rS6urc6Fcom02scfY9NSCzGOJmgkrPVn8k/280A9a+vOpb5ZFX60UgeDwNtKDLQ3Kryvw+BH1gud6LajDU2DfvuJZdi3yumvF+IjwKBgQDsvgyL8gr+wcAaBqXf3tjAHWNUiphD8aWxZSGG7bIdmwIIOBAtv9sxE2I++3qgoakYTZsrPWjiWc3BFSSDX2S55VvsnSLetnKQNLpzFGXeLkwDB6HO3TBMECJnwletZae2wIZZlpfvwXP/YaHgkeh7d93L2jvCTQsQ9kuVi0WrTQKBgBG6bDPFfZQiklMi8t4mRqQKD42/Dk/3wapzfPB7YBVGXeh3dgEzgUPljujEIh9gIqv9wAadefN+zPdcELEiLWr1VxKKyo7C7qTZD3TaEhfp5SgLSE4/hYfBvRVci69UeGiAS5nsgZwoINYREXjsIvQjbdnNWAP7xJhJEIySZzApAoGBAObzfl6eTBzdmQO+L7NR43TD0Hlgy86nS29h0D56IPGcyOfJjXvJPvromGFr+cmkPAbjSSUXKJUOyJ8krxW8oKbvglPUIGxfV2eYIYG0F3WhCFQbeeDnbZ86vZMFWSSWU5zIgcJi1FJCqmY2SivvgxBj4X56ssuqAhGGaXUvZgRk
    # æ”¯ä»˜å®å…¬é’¥ï¼ˆä»æä¾›çš„æ–‡ä»¶ä¸­è¯»å–ï¼‰
    alipay-public-key-pem: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2sXLcJALLS93TitnoAQIvExn9j3X72VM4rvLXcO1F7ol7P2lkxwzqgY40WJ0sGiYrKNKp7MG0hoqm4zf//33YFS/tTqXeEOfrIXRe6VUKEr7HWNxTob4+fFr8qvatQu25wQUozuGuAZG9CKkmX6PtIA+6+EIohA0GP3RHP7JgcFATg32egoS00MqwNU776uGwlGXyQ+gI3bHDTL3PwII57PCfsxcxl7O4rVy/qJsu/z7ApbBNhefoNgRfRjrCqbi7ByoKn0+xMtt8Cqk07sm6fV0z0Vj6gOU7EesgKorzs0BIwIkO80Sby6uRCXLnDWnrAk/0zkjUbNzfmA1tWKSBwIDAQAB
    # å¼‚æ­¥é€šçŸ¥å›è°ƒåœ°å€ï¼ˆéœ€è¦å…¬ç½‘å¯è®¿é—®ï¼‰
    # å¼€å‘ç¯å¢ƒæš‚æ—¶ç•™ç©ºï¼Œåªä¾èµ–å‰ç«¯è½®è¯¢æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
    notify-url: ""