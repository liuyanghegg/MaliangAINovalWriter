server:
  port: 18080
  shutdown: graceful
  netty:
    connection-timeout: 5s

spring:
  application:
    name: ai-novel-server-performance-test
  
  # ✅ 改进: 使用独立的测试数据库
  data:
    mongodb:
      uri: mongodb://localhost:27017/ainoval_performance_test  # ✅ 独立测试库
      database: ainoval_performance_test
      auto-index-creation: true
      # 可选: 使用不同端口的MongoDB实例
      # uri: mongodb://localhost:27018/ainoval_performance_test
  
  webflux:
    base-path: /api
  
  lifecycle:
    timeout-per-shutdown-phase: 30s

logging:
  level:
    root: INFO
    com.ainovel: DEBUG
    org.springframework.data.mongodb: INFO
    org.springframework.web: INFO
    org.springframework.security: DEBUG  # 查看安全配置日志
    reactor.netty: INFO
  
  # 性能测试专用日志格式
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,jmx
    jmx:
      exposure:
        include: "*"
  
  endpoint:
    health:
      show-details: always
  
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: performance-test
    
    # 性能测试关键指标
    distribution:
      percentiles-histogram:
        "[http.server.requests]": true
      percentiles:
        "[http.server.requests]": [0.5, 0.95, 0.99]

# ✅ 自定义配置
ainovel:
  security:
    jwt:
      secret-key: test_secret_key_for_performance_testing_only
      expiration-time: 86400000  # 24小时
      refresh-token-expiration: 604800000  # 7天
  
  performance:
    virtual-threads:
      enabled: true  # ✅ 启用虚拟线程
    monitoring:
      enabled: true  # ✅ 启用监控
    testing:
      security-disabled: true  # ✅ 禁用安全验证
      auto-cleanup: true       # ✅ 自动清理旧测试数据
      max-test-data-age-hours: 24  # 测试数据最大保留时间

  # 版本控制配置
  version-control:
    enabled: false  # 性能测试时禁用版本控制,减少开销

# ✅ 性能测试专用配置
performance-test:
  # 测试数据配置
  data:
    default-novel-count: 100
    default-scenes-per-novel: 50
    max-novel-count: 1000
    max-scenes-per-novel: 500
  
  # 并发配置
  concurrency:
    max-parallel-requests: 200
    default-virtual-threads: 2000
  
  # 监控配置
  monitoring:
    jmx-enabled: true
    prometheus-enabled: true
    gc-logging-enabled: true


